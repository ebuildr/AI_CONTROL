<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Control System</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/alpinejs@3.x.x/dist/cdn.min.js" defer></script>
    <style>
        .gradient-bg {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        .glass-effect {
            backdrop-filter: blur(10px);
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        .chat-message {
            animation: slideIn 0.3s ease-out;
        }
        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        .typing-indicator {
            animation: pulse 1.5s infinite;
        }
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        .command-output {
            font-family: 'Courier New', monospace;
            background: #1a1a1a;
            color: #00ff00;
        }
        .screenshot-container {
            max-width: 100%;
            overflow: hidden;
            border-radius: 8px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.3);
        }
        .tab-content {
            display: none;
        }
        .tab-content.active {
            display: block;
        }
    </style>
</head>
<body class="gradient-bg min-h-screen" x-data="aiControlApp()">
    <!-- Header -->
    <header class="glass-effect text-white p-4 shadow-lg">
        <div class="container mx-auto flex items-center justify-between">
            <div class="flex items-center space-x-4">
                <h1 class="text-3xl font-bold">ü§ñ AI Control System</h1>
                <div class="flex items-center space-x-2">
                    <div class="w-3 h-3 rounded-full" :class="systemStatus.healthy ? 'bg-green-400' : 'bg-red-400'"></div>
                    <span class="text-sm" x-text="systemStatus.healthy ? 'Online' : 'Offline'"></span>
                </div>
            </div>
            <div class="flex items-center space-x-4">
                <select x-model="selectedModel" class="px-3 py-1 rounded bg-white/20 text-white border border-white/30">
                    <template x-for="model in availableModels" :key="model">
                        <option :value="model" x-text="model"></option>
                    </template>
                </select>
                <button @click="checkHealth()" class="px-4 py-2 bg-white/20 rounded hover:bg-white/30 transition-colors">
                    üîÑ Refresh
                </button>
            </div>
        </div>
    </header>

    <!-- Navigation Tabs -->
    <nav class="bg-black/20 text-white">
        <div class="container mx-auto">
            <div class="flex space-x-0">
                <button @click="activeTab = 'chat'" 
                        :class="activeTab === 'chat' ? 'bg-white/20' : 'bg-transparent hover:bg-white/10'"
                        class="px-6 py-3 transition-colors">
                    üí¨ AI Chat
                </button>
                <button @click="activeTab = 'pc'" 
                        :class="activeTab === 'pc' ? 'bg-white/20' : 'bg-transparent hover:bg-white/10'"
                        class="px-6 py-3 transition-colors">
                    üíª PC Control
                </button>
                <button @click="activeTab = 'web'" 
                        :class="activeTab === 'web' ? 'bg-white/20' : 'bg-transparent hover:bg-white/10'"
                        class="px-6 py-3 transition-colors">
                    üåê Web Browser
                </button>
                <button @click="activeTab = 'system'" 
                        :class="activeTab === 'system' ? 'bg-white/20' : 'bg-transparent hover:bg-white/10'"
                        class="px-6 py-3 transition-colors">
                    üìä System Status
                </button>
                <button @click="activeTab = 'acceleration'" 
                        :class="activeTab === 'acceleration' ? 'bg-white/20' : 'bg-transparent hover:bg-white/10'"
                        class="px-6 py-3 transition-colors">
                    ‚ö° AI Acceleration
                </button>
                <button @click="activeTab = 'monitoring'" 
                        :class="activeTab === 'monitoring' ? 'bg-white/20' : 'bg-transparent hover:bg-white/10'"
                        class="px-6 py-3 transition-colors">
                    üìä Real-time Monitor
                </button>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <main class="container mx-auto p-4 flex-1">
        <!-- AI Chat Tab -->
        <div class="tab-content" :class="activeTab === 'chat' ? 'active' : ''">
            <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 h-full">
                <!-- Chat Area -->
                <div class="lg:col-span-2">
                    <div class="glass-effect rounded-lg p-6 h-full flex flex-col">
                        <h2 class="text-2xl font-bold text-white mb-4">ü§ñ AI Assistant</h2>
                        
                        <!-- Chat Messages -->
                        <div class="flex-1 overflow-y-auto space-y-4 mb-4 max-h-96" id="chatContainer">
                            <template x-for="message in chatMessages" :key="message.id">
                                <div class="chat-message" :class="message.type === 'user' ? 'text-right' : 'text-left'">
                                    <div class="inline-block max-w-3/4 p-3 rounded-lg" 
                                         :class="message.type === 'user' ? 'bg-blue-500 text-white' : 'bg-white/90 text-gray-800'">
                                        <div class="font-semibold text-sm mb-1" x-text="message.type === 'user' ? 'You' : selectedModel"></div>
                                        <div x-html="formatMessage(message.content)"></div>
                                        <div class="text-xs opacity-70 mt-2" x-text="message.timestamp"></div>
                                    </div>
                                </div>
                            </template>
                            
                            <!-- Typing Indicator -->
                            <div x-show="isTyping" class="typing-indicator text-left">
                                <div class="inline-block bg-white/90 text-gray-800 p-3 rounded-lg">
                                    <div class="flex space-x-1">
                                        <div class="w-2 h-2 bg-gray-500 rounded-full animate-bounce"></div>
                                        <div class="w-2 h-2 bg-gray-500 rounded-full animate-bounce" style="animation-delay: 0.1s"></div>
                                        <div class="w-2 h-2 bg-gray-500 rounded-full animate-bounce" style="animation-delay: 0.2s"></div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Chat Input -->
                        <div class="flex space-x-2">
                            <input x-model="chatInput" 
                                   @keydown.enter="sendMessage()"
                                   placeholder="Type your message..."
                                   class="flex-1 px-4 py-2 rounded-lg bg-white/20 text-white placeholder-white/70 border border-white/30 focus:outline-none focus:border-white/50">
                            <button @click="sendMessage()" 
                                    :disabled="!chatInput.trim() || isTyping"
                                    class="px-6 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 disabled:bg-gray-500 disabled:cursor-not-allowed transition-colors">
                                Send
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Chat Settings -->
                <div class="lg:col-span-1">
                    <div class="glass-effect rounded-lg p-6">
                        <h3 class="text-xl font-bold text-white mb-4">‚öôÔ∏è Settings</h3>
                        
                        <div class="space-y-4">
                            <div>
                                <label class="block text-white text-sm font-medium mb-2">Temperature</label>
                                <input x-model="temperature" type="range" min="0" max="2" step="0.1" 
                                       class="w-full">
                                <div class="text-white text-sm" x-text="'Value: ' + temperature"></div>
                            </div>
                            
                            <div>
                                <label class="block text-white text-sm font-medium mb-2">System Prompt</label>
                                <textarea x-model="systemPrompt" 
                                          class="w-full px-3 py-2 rounded bg-white/20 text-white placeholder-white/70 border border-white/30 focus:outline-none focus:border-white/50"
                                          rows="4"
                                          placeholder="Enter system prompt..."></textarea>
                            </div>
                            
                            <div>
                                <label class="flex items-center text-white">
                                    <input x-model="streamResponse" type="checkbox" class="mr-2">
                                    Stream Response
                                </label>
                            </div>
                            
                            <button @click="clearChat()" 
                                    class="w-full px-4 py-2 bg-red-500 text-white rounded hover:bg-red-600 transition-colors">
                                Clear Chat
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- PC Control Tab -->
        <div class="tab-content" :class="activeTab === 'pc' ? 'active' : ''">
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                <!-- Command Interface -->
                <div class="glass-effect rounded-lg p-6">
                    <h2 class="text-2xl font-bold text-white mb-4">üíª PC Commands</h2>
                    
                    <div class="space-y-4">
                        <div>
                            <label class="block text-white text-sm font-medium mb-2">Command Type</label>
                            <select x-model="pcCommand.type" class="w-full px-3 py-2 rounded bg-white/20 text-white border border-white/30">
                                <option value="system">System</option>
                                <option value="file">File Operations</option>
                                <option value="process">Process Control</option>
                                <option value="application">Applications</option>
                            </select>
                        </div>
                        
                        <div>
                            <label class="block text-white text-sm font-medium mb-2">Command</label>
                            <input x-model="pcCommand.command" 
                                   class="w-full px-3 py-2 rounded bg-white/20 text-white placeholder-white/70 border border-white/30 focus:outline-none focus:border-white/50"
                                   placeholder="Enter command...">
                        </div>
                        
                        <div>
                            <label class="block text-white text-sm font-medium mb-2">Parameters (JSON)</label>
                            <textarea x-model="pcCommand.parameters" 
                                      class="w-full px-3 py-2 rounded bg-white/20 text-white placeholder-white/70 border border-white/30 focus:outline-none focus:border-white/50"
                                      rows="3"
                                      placeholder='{"key": "value"}'></textarea>
                        </div>
                        
                        <button @click="executePCCommand()" 
                                :disabled="!pcCommand.command.trim()"
                                class="w-full px-4 py-2 bg-green-500 text-white rounded hover:bg-green-600 disabled:bg-gray-500 disabled:cursor-not-allowed transition-colors">
                            Execute Command
                        </button>
                    </div>
                    
                    <!-- Quick Actions -->
                    <div class="mt-6">
                        <h3 class="text-lg font-semibold text-white mb-3">Quick Actions</h3>
                        <div class="grid grid-cols-2 gap-2">
                            <button @click="quickCommand('system', 'dir')" class="px-3 py-2 bg-blue-500 text-white rounded hover:bg-blue-600 text-sm">
                                üìÅ List Files
                            </button>
                            <button @click="quickCommand('application', 'open', {application: 'notepad'})" class="px-3 py-2 bg-blue-500 text-white rounded hover:bg-blue-600 text-sm">
                                üìù Notepad
                            </button>
                            <button @click="quickCommand('application', 'open', {application: 'calculator'})" class="px-3 py-2 bg-blue-500 text-white rounded hover:bg-blue-600 text-sm">
                                üßÆ Calculator
                            </button>
                            <button @click="quickCommand('system', 'tasklist')" class="px-3 py-2 bg-blue-500 text-white rounded hover:bg-blue-600 text-sm">
                                üìä Processes
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Command Output -->
                <div class="glass-effect rounded-lg p-6">
                    <h3 class="text-xl font-bold text-white mb-4">üìÑ Output</h3>
                    <div class="command-output p-4 rounded-lg min-h-96 max-h-96 overflow-y-auto">
                        <pre x-text="pcOutput" class="whitespace-pre-wrap text-sm"></pre>
                    </div>
                </div>
            </div>
        </div>

        <!-- Web Browser Tab -->
        <div class="tab-content" :class="activeTab === 'web' ? 'active' : ''">
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                <!-- Browser Controls -->
                <div class="glass-effect rounded-lg p-6">
                    <h2 class="text-2xl font-bold text-white mb-4">üåê Web Browser</h2>
                    
                    <div class="space-y-4">
                        <div>
                            <label class="block text-white text-sm font-medium mb-2">Action</label>
                            <select x-model="webAction.action" class="w-full px-3 py-2 rounded bg-white/20 text-white border border-white/30">
                                <option value="navigate">Navigate to URL</option>
                                <option value="search">Search Google</option>
                                <option value="screenshot">Take Screenshot</option>
                                <option value="get_content">Get Page Content</option>
                                <option value="click">Click Element</option>
                                <option value="type">Type Text</option>
                                <option value="extract_links">Extract Links</option>
                            </select>
                        </div>
                        
                        <div x-show="['navigate', 'search'].includes(webAction.action)">
                            <label class="block text-white text-sm font-medium mb-2">
                                <span x-text="webAction.action === 'search' ? 'Search Query' : 'URL'"></span>
                            </label>
                            <input x-model="webAction.url" 
                                   class="w-full px-3 py-2 rounded bg-white/20 text-white placeholder-white/70 border border-white/30 focus:outline-none focus:border-white/50"
                                   :placeholder="webAction.action === 'search' ? 'Enter search terms...' : 'https://example.com'">
                        </div>
                        
                        <div x-show="['click', 'type'].includes(webAction.action)">
                            <label class="block text-white text-sm font-medium mb-2">CSS Selector</label>
                            <input x-model="webAction.selector" 
                                   class="w-full px-3 py-2 rounded bg-white/20 text-white placeholder-white/70 border border-white/30 focus:outline-none focus:border-white/50"
                                   placeholder="e.g., #button-id or .class-name">
                        </div>
                        
                        <div x-show="webAction.action === 'type'">
                            <label class="block text-white text-sm font-medium mb-2">Text to Type</label>
                            <input x-model="webAction.text" 
                                   class="w-full px-3 py-2 rounded bg-white/20 text-white placeholder-white/70 border border-white/30 focus:outline-none focus:border-white/50"
                                   placeholder="Text to type...">
                        </div>
                        
                        <button @click="executeWebAction()" 
                                class="w-full px-4 py-2 bg-purple-500 text-white rounded hover:bg-purple-600 transition-colors">
                            Execute Action
                        </button>
                    </div>
                    
                    <!-- Quick Web Actions -->
                    <div class="mt-6">
                        <h3 class="text-lg font-semibold text-white mb-3">Quick Actions</h3>
                        <div class="grid grid-cols-1 gap-2">
                            <button @click="quickWebAction('search', 'AI news')" class="px-3 py-2 bg-purple-500 text-white rounded hover:bg-purple-600 text-sm">
                                üîç Search AI News
                            </button>
                            <button @click="quickWebAction('navigate', 'https://github.com')" class="px-3 py-2 bg-purple-500 text-white rounded hover:bg-purple-600 text-sm">
                                üêô GitHub
                            </button>
                            <button @click="quickWebAction('screenshot')" class="px-3 py-2 bg-purple-500 text-white rounded hover:bg-purple-600 text-sm">
                                üì∏ Screenshot
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Web Output -->
                <div class="glass-effect rounded-lg p-6">
                    <h3 class="text-xl font-bold text-white mb-4">üñºÔ∏è Web Output</h3>
                    <div class="bg-white/10 p-4 rounded-lg min-h-96 max-h-96 overflow-y-auto">
                        <!-- Screenshot Display -->
                        <div x-show="webScreenshot" class="screenshot-container mb-4">
                            <img :src="'data:image/png;base64,' + webScreenshot" alt="Screenshot" class="w-full">
                        </div>
                        
                        <!-- Text Output -->
                        <div x-show="webOutput && !webScreenshot">
                            <pre x-text="webOutput" class="whitespace-pre-wrap text-sm text-white"></pre>
                        </div>
                        
                        <!-- Placeholder -->
                        <div x-show="!webOutput && !webScreenshot" class="text-white/70 text-center py-8">
                            Execute a web action to see results here
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- System Status Tab -->
        <div class="tab-content" :class="activeTab === 'system' ? 'active' : ''">
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                <!-- System Overview -->
                <div class="glass-effect rounded-lg p-6">
                    <h2 class="text-2xl font-bold text-white mb-4">üìä System Overview</h2>
                    
                    <div class="space-y-4">
                        <div class="flex justify-between items-center">
                            <span class="text-white">CPU Usage:</span>
                            <div class="flex items-center space-x-2">
                                <div class="w-32 bg-white/20 rounded-full h-2">
                                    <div class="bg-blue-500 h-2 rounded-full" :style="`width: ${systemStats.cpu_percent || 0}%`"></div>
                                </div>
                                <span class="text-white text-sm" x-text="(systemStats.cpu_percent || 0).toFixed(1) + '%'"></span>
                            </div>
                        </div>
                        
                        <div class="flex justify-between items-center">
                            <span class="text-white">Memory Usage:</span>
                            <div class="flex items-center space-x-2">
                                <div class="w-32 bg-white/20 rounded-full h-2">
                                    <div class="bg-green-500 h-2 rounded-full" :style="`width: ${systemStats.memory_percent || 0}%`"></div>
                                </div>
                                <span class="text-white text-sm" x-text="(systemStats.memory_percent || 0).toFixed(1) + '%'"></span>
                            </div>
                        </div>
                        
                        <div class="flex justify-between items-center">
                            <span class="text-white">Disk Usage:</span>
                            <div class="flex items-center space-x-2">
                                <div class="w-32 bg-white/20 rounded-full h-2">
                                    <div class="bg-yellow-500 h-2 rounded-full" :style="`width: ${systemStats.disk_percent || 0}%`"></div>
                                </div>
                                <span class="text-white text-sm" x-text="(systemStats.disk_percent || 0).toFixed(1) + '%'"></span>
                            </div>
                        </div>
                        
                        <div class="pt-4 border-t border-white/20">
                            <div class="grid grid-cols-2 gap-4 text-sm">
                                <div>
                                    <div class="text-white/70">Platform:</div>
                                    <div class="text-white font-medium" x-text="systemStats.platform || 'Unknown'"></div>
                                </div>
                                <div>
                                    <div class="text-white/70">Admin:</div>
                                    <div class="text-white font-medium" x-text="systemStats.is_admin ? 'Yes' : 'No'"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <button @click="refreshSystemStats()" 
                            class="w-full mt-4 px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600 transition-colors">
                        üîÑ Refresh Stats
                    </button>
                </div>

                <!-- Process List -->
                <div class="glass-effect rounded-lg p-6">
                    <h3 class="text-xl font-bold text-white mb-4">üîÑ Running Processes</h3>
                    <div class="bg-white/10 p-4 rounded-lg max-h-96 overflow-y-auto">
                        <div class="space-y-2">
                            <template x-for="process in processes.slice(0, 10)" :key="process.pid">
                                <div class="flex justify-between items-center text-sm">
                                    <div class="text-white" x-text="process.name"></div>
                                    <div class="text-white/70" x-text="process.cpu_percent + '%'"></div>
                                </div>
                            </template>
                        </div>
                    </div>
                    
                    <button @click="refreshProcesses()" 
                            class="w-full mt-4 px-4 py-2 bg-green-500 text-white rounded hover:bg-green-600 transition-colors">
                        üîÑ Refresh Processes
                    </button>
                </div>
            </div>
        </div>

        <!-- AI Acceleration Tab -->
        <div class="tab-content" :class="activeTab === 'acceleration' ? 'active' : ''">
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                <!-- NPU Status -->
                <div class="glass-effect rounded-lg p-6">
                    <h2 class="text-2xl font-bold text-white mb-4">üß† NPU Status</h2>
                    
                    <div class="space-y-4">
                        <div class="flex justify-between items-center">
                            <span class="text-white">NPU Available:</span>
                            <div class="flex items-center space-x-2">
                                <div class="w-3 h-3 rounded-full" :class="npuStatus.npu_available ? 'bg-green-400' : 'bg-red-400'"></div>
                                <span class="text-white text-sm" x-text="npuStatus.npu_available ? 'Yes' : 'No'"></span>
                            </div>
                        </div>
                        
                        <div class="flex justify-between items-center">
                            <span class="text-white">Device Count:</span>
                            <span class="text-white text-sm" x-text="npuStatus.device_count || 0"></span>
                        </div>
                        
                        <div class="pt-4 border-t border-white/20" x-show="npuStatus.npu_available">
                            <h3 class="text-white font-semibold mb-2">NPU Devices:</h3>
                            <template x-for="device in npuStatus.devices" :key="device.name">
                                <div class="bg-white/10 rounded p-3 mb-2">
                                    <div class="text-white font-medium" x-text="device.name"></div>
                                    <div class="text-white/70 text-sm">
                                        <span x-text="device.vendor"></span> | 
                                        <span x-text="device.type"></span> |
                                        <span x-text="device.status"></span>
                                    </div>
                                </div>
                            </template>
                        </div>
                    </div>
                    
                    <button @click="refreshNPUStatus()" 
                            class="w-full mt-4 px-4 py-2 bg-purple-500 text-white rounded hover:bg-purple-600 transition-colors">
                        üîÑ Refresh NPU Status
                    </button>
                </div>

                <!-- NPU Performance -->
                <div class="glass-effect rounded-lg p-6">
                    <h2 class="text-2xl font-bold text-white mb-4">‚ö° NPU Performance</h2>
                    
                    <div class="space-y-4" x-show="npuStatus.npu_available">
                        <div class="flex justify-between items-center">
                            <span class="text-white">Utilization:</span>
                            <div class="flex items-center space-x-2">
                                <div class="w-32 bg-white/20 rounded-full h-2">
                                    <div class="bg-purple-500 h-2 rounded-full" :style="`width: ${npuPerformance.utilization || 0}%`"></div>
                                </div>
                                <span class="text-white text-sm" x-text="(npuPerformance.utilization || 0).toFixed(1) + '%'"></span>
                            </div>
                        </div>
                        
                        <div x-show="npuCapabilities && Object.keys(npuCapabilities).length > 0">
                            <h3 class="text-white font-semibold mb-2">NPU Capabilities:</h3>
                            <template x-for="[deviceName, caps] in Object.entries(npuCapabilities)" :key="deviceName">
                                <div class="bg-white/10 rounded p-3 mb-2">
                                    <div class="text-white/70 text-sm">
                                        <div><strong>TOPS:</strong> <span x-text="caps.tops"></span></div>
                                        <div><strong>Formats:</strong> <span x-text="caps.supported_formats?.join(', ')"></span></div>
                                        <div><strong>Frameworks:</strong> <span x-text="caps.frameworks?.join(', ')"></span></div>
                                    </div>
                                </div>
                            </template>
                        </div>
                    </div>
                    
                    <div x-show="!npuStatus.npu_available" class="text-center text-white/70">
                        No NPU detected. Consider upgrading to a processor with integrated NPU for AI acceleration.
                    </div>
                    
                    <button @click="runNPUBenchmark()" 
                            x-show="npuStatus.npu_available"
                            class="w-full mt-4 px-4 py-2 bg-orange-500 text-white rounded hover:bg-orange-600 transition-colors">
                        üèÉ Run NPU Benchmark
                    </button>
                </div>

                <!-- GPU Status -->
                <div class="glass-effect rounded-lg p-6">
                    <h2 class="text-2xl font-bold text-white mb-4">üéÆ GPU Status</h2>
                    
                    <div class="space-y-4">
                        <div class="flex justify-between items-center">
                            <span class="text-white">GPUs Available:</span>
                            <div class="flex items-center space-x-2">
                                <div class="w-3 h-3 rounded-full" :class="gpuStatus.gpus_available ? 'bg-green-400' : 'bg-red-400'"></div>
                                <span class="text-white text-sm" x-text="gpuStatus.gpus_available ? 'Yes' : 'No'"></span>
                            </div>
                        </div>
                        
                        <div class="flex justify-between items-center">
                            <span class="text-white">Device Count:</span>
                            <span class="text-white text-sm" x-text="gpuStatus.device_count || 0"></span>
                        </div>
                        
                        <div class="pt-4 border-t border-white/20" x-show="gpuStatus.gpus_available">
                            <h3 class="text-white font-semibold mb-2">GPU Devices:</h3>
                            <template x-for="device in gpuStatus.devices" :key="device.name">
                                <div class="bg-white/10 rounded p-3 mb-2">
                                    <div class="text-white font-medium" x-text="device.name"></div>
                                    <div class="text-white/70 text-sm">
                                        <span x-text="device.vendor"></span> | 
                                        <span x-text="device.type"></span>
                                        <div x-show="device.memory_total">Memory: <span x-text="Math.round(device.memory_total / 1024 / 1024 / 1024) + ' GB'"></span></div>
                                    </div>
                                </div>
                            </template>
                        </div>
                        
                        <div class="pt-4 border-t border-white/20" x-show="gpuStatus.frameworks">
                            <h3 class="text-white font-semibold mb-2">AI Frameworks:</h3>
                            <div class="grid grid-cols-3 gap-2 text-sm">
                                <div class="flex items-center space-x-1">
                                    <div class="w-2 h-2 rounded-full" :class="gpuStatus.frameworks?.cuda ? 'bg-green-400' : 'bg-red-400'"></div>
                                    <span class="text-white/80">CUDA</span>
                                </div>
                                <div class="flex items-center space-x-1">
                                    <div class="w-2 h-2 rounded-full" :class="gpuStatus.frameworks?.opencl ? 'bg-green-400' : 'bg-red-400'"></div>
                                    <span class="text-white/80">OpenCL</span>
                                </div>
                                <div class="flex items-center space-x-1">
                                    <div class="w-2 h-2 rounded-full" :class="gpuStatus.frameworks?.directml ? 'bg-green-400' : 'bg-red-400'"></div>
                                    <span class="text-white/80">DirectML</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <button @click="refreshGPUStatus()" 
                            class="w-full mt-4 px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600 transition-colors">
                        üîÑ Refresh GPU Status
                    </button>
                </div>

                <!-- GPU Performance -->
                <div class="glass-effect rounded-lg p-6">
                    <h2 class="text-2xl font-bold text-white mb-4">‚ö° GPU Performance</h2>
                    
                    <div class="space-y-4" x-show="gpuStatus.gpus_available">
                        <template x-for="device in gpuPerformance.devices" :key="device.device_id">
                            <div class="bg-white/10 rounded p-3">
                                <div class="text-white font-medium mb-2" x-text="device.name"></div>
                                
                                <div class="space-y-2">
                                    <div class="flex justify-between items-center">
                                        <span class="text-white/70 text-sm">GPU Utilization:</span>
                                        <div class="flex items-center space-x-2">
                                            <div class="w-20 bg-white/20 rounded-full h-1">
                                                <div class="bg-blue-500 h-1 rounded-full" :style="`width: ${device.gpu_utilization || 0}%`"></div>
                                            </div>
                                            <span class="text-white/70 text-xs" x-text="(device.gpu_utilization || 0) + '%'"></span>
                                        </div>
                                    </div>
                                    
                                    <div class="flex justify-between items-center">
                                        <span class="text-white/70 text-sm">Memory:</span>
                                        <div class="flex items-center space-x-2">
                                            <div class="w-20 bg-white/20 rounded-full h-1">
                                                <div class="bg-green-500 h-1 rounded-full" :style="`width: ${device.memory_used && device.memory_total ? (device.memory_used / device.memory_total * 100) : 0}%`"></div>
                                            </div>
                                            <span class="text-white/70 text-xs" x-text="device.memory_used && device.memory_total ? Math.round(device.memory_used / device.memory_total * 100) + '%' : 'N/A'"></span>
                                        </div>
                                    </div>
                                    
                                    <div class="grid grid-cols-2 gap-2 text-xs text-white/60">
                                        <div x-show="device.temperature">Temp: <span x-text="device.temperature + '¬∞C'"></span></div>
                                        <div x-show="device.power_usage">Power: <span x-text="device.power_usage + 'W'"></span></div>
                                    </div>
                                </div>
                            </div>
                        </template>
                    </div>
                    
                    <div x-show="!gpuStatus.gpus_available" class="text-center text-white/70">
                        No dedicated GPU detected. Using integrated graphics.
                    </div>
                    
                    <button @click="runGPUBenchmark()" 
                            x-show="gpuStatus.gpus_available"
                            class="w-full mt-4 px-4 py-2 bg-orange-500 text-white rounded hover:bg-orange-600 transition-colors">
                        üèÉ Run GPU Benchmark
                    </button>
                </div>

                <!-- Model Optimization -->
                <div class="glass-effect rounded-lg p-6 lg:col-span-2" x-show="npuStatus.npu_available || gpuStatus.gpus_available">
                    <h2 class="text-2xl font-bold text-white mb-4">üîß Model Optimization</h2>
                    
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <div>
                            <label class="block text-white/70 text-sm font-medium mb-2">Select Model:</label>
                            <select x-model="selectedOptimizeModel" class="w-full px-3 py-2 bg-white/20 text-white rounded border border-white/30">
                                <template x-for="model in availableModels" :key="model">
                                    <option :value="model" x-text="model"></option>
                                </template>
                            </select>
                        </div>
                        
                        <div>
                            <label class="block text-white/70 text-sm font-medium mb-2">Acceleration Type:</label>
                            <select x-model="selectedAccelerationType" class="w-full px-3 py-2 bg-white/20 text-white rounded border border-white/30">
                                <option value="auto">Auto (Best Available)</option>
                                <option value="npu" x-show="npuStatus.npu_available">NPU</option>
                                <option value="cuda" x-show="gpuStatus.frameworks?.cuda">CUDA (NVIDIA)</option>
                                <option value="opencl" x-show="gpuStatus.frameworks?.opencl">OpenCL</option>
                                <option value="directml" x-show="gpuStatus.frameworks?.directml">DirectML</option>
                            </select>
                        </div>
                        
                        <div>
                            <button @click="optimizeModelForAcceleration()" 
                                    class="w-full px-4 py-2 bg-green-500 text-white rounded hover:bg-green-600 transition-colors mt-6">
                                üöÄ Optimize Model
                            </button>
                        </div>
                    </div>
                    
                    <div x-show="optimizationResult" class="mt-4 p-4 bg-white/10 rounded">
                        <h3 class="text-white font-semibold mb-2">Optimization Result:</h3>
                        <pre class="text-white/80 text-sm overflow-x-auto" x-text="JSON.stringify(optimizationResult, null, 2)"></pre>
                    </div>
                </div>
            </div>
        </div>

        <!-- Real-time Monitoring Tab -->
        <div class="tab-content" :class="activeTab === 'monitoring' ? 'active' : ''">
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                <!-- CPU & Memory Monitor -->
                <div class="glass-effect rounded-lg p-6">
                    <h2 class="text-2xl font-bold text-white mb-4">üñ•Ô∏è CPU & Memory</h2>
                    
                    <div class="space-y-4">
                        <!-- CPU Usage -->
                        <div>
                            <div class="flex justify-between items-center mb-2">
                                <span class="text-white font-medium">CPU Usage</span>
                                <span class="text-white" x-text="(realtimeMetrics.cpu?.usage_percent || 0).toFixed(1) + '%'"></span>
                            </div>
                            <div class="w-full bg-white/20 rounded-full h-3">
                                <div class="bg-blue-500 h-3 rounded-full transition-all duration-500" 
                                     :style="`width: ${realtimeMetrics.cpu?.usage_percent || 0}%`"></div>
                            </div>
                            <div class="mt-2 grid grid-cols-4 gap-2">
                                <template x-for="(usage, index) in (realtimeMetrics.cpu?.per_core_usage || [])" :key="index">
                                    <div class="text-xs text-white/70">
                                        <div class="text-center">C<span x-text="index"></span></div>
                                        <div class="w-full bg-white/10 rounded h-8">
                                            <div class="bg-blue-400 rounded transition-all duration-500" 
                                                 :style="`height: ${usage}%; width: 100%`"></div>
                                        </div>
                                    </div>
                                </template>
                            </div>
                        </div>
                        
                        <!-- Memory Usage -->
                        <div>
                            <div class="flex justify-between items-center mb-2">
                                <span class="text-white font-medium">Memory Usage</span>
                                <span class="text-white" x-text="`${(realtimeMetrics.memory?.used_gb || 0).toFixed(1)}GB / ${(realtimeMetrics.memory?.total_gb || 0).toFixed(1)}GB`"></span>
                            </div>
                            <div class="w-full bg-white/20 rounded-full h-3">
                                <div class="bg-green-500 h-3 rounded-full transition-all duration-500" 
                                     :style="`width: ${realtimeMetrics.memory?.percent || 0}%`"></div>
                            </div>
                        </div>
                        
                        <!-- CPU Temperature & Frequency -->
                        <div class="grid grid-cols-2 gap-4 text-sm text-white/80">
                            <div x-show="realtimeMetrics.cpu?.temperature">
                                <span class="font-medium">Temperature:</span> 
                                <span x-text="(realtimeMetrics.cpu?.temperature || 0).toFixed(1) + '¬∞C'"></span>
                            </div>
                            <div x-show="realtimeMetrics.cpu?.frequency_current">
                                <span class="font-medium">Frequency:</span> 
                                <span x-text="(realtimeMetrics.cpu?.frequency_current / 1000 || 0).toFixed(2) + ' GHz'"></span>
                            </div>
                        </div>
                    </div>
                    
                    <!-- CPU History Chart -->
                    <div class="mt-6">
                        <canvas id="cpuChart" width="400" height="200"></canvas>
                    </div>
                </div>
                
                <!-- NPU & GPU Monitor -->
                <div class="glass-effect rounded-lg p-6">
                    <h2 class="text-2xl font-bold text-white mb-4">‚ö° NPU & GPU</h2>
                    
                    <div class="space-y-4">
                        <!-- NPU Usage -->
                        <div x-show="realtimeMetrics.npu?.available">
                            <div class="flex justify-between items-center mb-2">
                                <span class="text-white font-medium">NPU Usage</span>
                                <span class="text-white" x-text="(realtimeMetrics.npu?.usage_percent || 0).toFixed(1) + '%'"></span>
                            </div>
                            <div class="w-full bg-white/20 rounded-full h-3">
                                <div class="bg-cyan-500 h-3 rounded-full transition-all duration-500" 
                                     :style="`width: ${realtimeMetrics.npu?.usage_percent || 0}%`"></div>
                            </div>
                            <div class="mt-2 text-sm text-white/70">
                                <span>Power: </span><span x-text="(realtimeMetrics.npu?.power_watts || 0).toFixed(1) + 'W'"></span>
                                <span class="ml-4">Throughput: </span><span x-text="(realtimeMetrics.npu?.inference_throughput || 0) + ' inf/s'"></span>
                            </div>
                        </div>
                        
                        <!-- GPU Usage -->
                        <template x-for="gpu in (realtimeMetrics.gpu?.devices || [])" :key="gpu.id">
                            <div>
                                <div class="text-white font-medium mb-2" x-text="gpu.name"></div>
                                
                                <!-- GPU Core Usage -->
                                <div class="flex justify-between items-center mb-1">
                                    <span class="text-white/70 text-sm">GPU Usage</span>
                                    <span class="text-white text-sm" x-text="(gpu.gpu_usage || 0) + '%'"></span>
                                </div>
                                <div class="w-full bg-white/20 rounded-full h-2 mb-2">
                                    <div class="bg-orange-500 h-2 rounded-full transition-all duration-500" 
                                         :style="`width: ${gpu.gpu_usage || 0}%`"></div>
                                </div>
                                
                                <!-- GPU Memory Usage -->
                                <div class="flex justify-between items-center mb-1">
                                    <span class="text-white/70 text-sm">Memory Usage</span>
                                    <span class="text-white text-sm" x-text="`${gpu.memory_used_gb}GB / ${gpu.memory_total_gb}GB`"></span>
                                </div>
                                <div class="w-full bg-white/20 rounded-full h-2 mb-3">
                                    <div class="bg-yellow-500 h-2 rounded-full transition-all duration-500" 
                                         :style="`width: ${gpu.memory_usage || 0}%`"></div>
                                </div>
                                
                                <!-- GPU Details -->
                                <div class="grid grid-cols-2 gap-2 text-xs text-white/70">
                                    <div x-show="gpu.temperature">Temp: <span x-text="gpu.temperature + '¬∞C'"></span></div>
                                    <div x-show="gpu.power_watts">Power: <span x-text="gpu.power_watts + 'W'"></span></div>
                                    <div x-show="gpu.graphics_clock_mhz">Core: <span x-text="gpu.graphics_clock_mhz + ' MHz'"></span></div>
                                    <div x-show="gpu.fan_speed_percent">Fan: <span x-text="gpu.fan_speed_percent + '%'"></span></div>
                                </div>
                            </div>
                        </template>
                    </div>
                    
                    <!-- GPU History Chart -->
                    <div class="mt-6">
                        <canvas id="gpuChart" width="400" height="200"></canvas>
                    </div>
                </div>
                
                <!-- AI Processes -->
                <div class="glass-effect rounded-lg p-6 lg:col-span-2">
                    <h2 class="text-2xl font-bold text-white mb-4">üß† AI Processes</h2>
                    
                    <div class="overflow-x-auto">
                        <table class="w-full text-white">
                            <thead>
                                <tr class="border-b border-white/20">
                                    <th class="text-left p-2">Process</th>
                                    <th class="text-right p-2">PID</th>
                                    <th class="text-right p-2">CPU %</th>
                                    <th class="text-right p-2">Memory %</th>
                                </tr>
                            </thead>
                            <tbody>
                                <template x-for="process in (realtimeMetrics.processes || [])" :key="process.pid">
                                    <tr class="border-b border-white/10">
                                        <td class="p-2" x-text="process.name"></td>
                                        <td class="text-right p-2" x-text="process.pid"></td>
                                        <td class="text-right p-2" x-text="(process.cpu_percent || 0).toFixed(1) + '%'"></td>
                                        <td class="text-right p-2" x-text="(process.memory_percent || 0).toFixed(1) + '%'"></td>
                                    </tr>
                                </template>
                            </tbody>
                        </table>
                        
                        <div x-show="!realtimeMetrics.processes || realtimeMetrics.processes.length === 0" 
                             class="text-center text-white/50 py-4">
                            No AI processes detected
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Footer -->
    <footer class="glass-effect text-white p-4 mt-8">
        <div class="container mx-auto text-center">
            <p>&copy; 2024 AI Control System - Advanced Local AI with PC Control</p>
            <p class="text-sm text-white/70 mt-1">Status: <span x-text="systemStatus.healthy ? 'Online' : 'Offline'"></span> | 
               Models: <span x-text="availableModels.length"></span> | 
               Active: <span x-text="selectedModel"></span></p>
        </div>
    </footer>

    <script>
        function aiControlApp() {
            return {
                // State
                activeTab: 'chat',
                systemStatus: { healthy: false },
                availableModels: ['gpt-oss:20b', 'gpt-oss:120b', 'llama3.1:8b'],
                selectedModel: 'gpt-oss:20b',
                
                // Chat
                chatMessages: [],
                chatInput: '',
                isTyping: false,
                temperature: 0.7,
                systemPrompt: '',
                streamResponse: false,
                
                // PC Control
                pcCommand: {
                    type: 'system',
                    command: '',
                    parameters: ''
                },
                pcOutput: 'Ready to execute commands...',
                
                // Web Browser
                webAction: {
                    action: 'navigate',
                    url: '',
                    selector: '',
                    text: ''
                },
                webOutput: '',
                webScreenshot: '',
                
                // System Stats
                systemStats: {},
                processes: [],
                
                // NPU
                npuStatus: { npu_available: false, device_count: 0, devices: [] },
                npuPerformance: { utilization: 0 },
                npuCapabilities: {},
                
                // GPU
                gpuStatus: { gpus_available: false, device_count: 0, devices: [], frameworks: {} },
                gpuPerformance: { devices: [] },
                gpuCapabilities: {},
                
                // Hardware Acceleration
                selectedOptimizeModel: '',
                selectedAccelerationType: 'auto',
                optimizationResult: null,
                
                // Real-time monitoring
                realtimeMetrics: {},
                monitoringWebSocket: null,
                cpuChart: null,
                gpuChart: null,
                
                // Initialize
                async init() {
                    await this.checkHealth();
                    await this.loadModels();
                    await this.refreshSystemStats();
                    await this.refreshNPUStatus();
                    await this.refreshGPUStatus();
                    
                    // Auto-refresh health every 30 seconds
                    setInterval(() => this.checkHealth(), 30000);
                    // Auto-refresh hardware acceleration status every 60 seconds
                    setInterval(() => {
                        this.refreshNPUStatus();
                        this.refreshGPUStatus();
                    }, 60000);
                    
                    // Initialize real-time monitoring
                    this.initRealtimeMonitoring();
                },
                
                // Health Check
                async checkHealth() {
                    try {
                        const response = await fetch('/health');
                        const data = await response.json();
                        this.systemStatus = { healthy: response.ok };
                        if (data.system) {
                            this.systemStats = data.system;
                        }
                    } catch (error) {
                        this.systemStatus = { healthy: false };
                        console.error('Health check failed:', error);
                    }
                },
                
                // Load Available Models
                async loadModels() {
                    try {
                        const response = await fetch('/models');
                        const data = await response.json();
                        if (data.models && data.models.length > 0) {
                            this.availableModels = data.models;
                            if (!this.selectedModel || !data.models.includes(this.selectedModel)) {
                                this.selectedModel = data.models[0];
                            }
                        }
                    } catch (error) {
                        console.error('Failed to load models:', error);
                    }
                },
                
                // Chat Functions
                async sendMessage() {
                    if (!this.chatInput.trim() || this.isTyping) return;
                    
                    const message = this.chatInput.trim();
                    this.chatInput = '';
                    
                    // Add user message
                    this.addMessage('user', message);
                    
                    this.isTyping = true;
                    
                    try {
                        const response = await fetch('/chat', {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify({
                                model: this.selectedModel,
                                prompt: message,
                                system_prompt: this.systemPrompt || null,
                                temperature: this.temperature,
                                stream: this.streamResponse
                            })
                        });
                        
                        const data = await response.json();
                        
                        if (response.ok) {
                            this.addMessage('assistant', data.response);
                        } else {
                            this.addMessage('assistant', `Error: ${data.detail || 'Unknown error'}`);
                        }
                    } catch (error) {
                        this.addMessage('assistant', `Error: ${error.message}`);
                    } finally {
                        this.isTyping = false;
                    }
                },
                
                addMessage(type, content) {
                    this.chatMessages.push({
                        id: Date.now(),
                        type: type,
                        content: content,
                        timestamp: new Date().toLocaleTimeString()
                    });
                    
                    // Scroll to bottom
                    this.$nextTick(() => {
                        const container = document.getElementById('chatContainer');
                        container.scrollTop = container.scrollHeight;
                    });
                },
                
                formatMessage(content) {
                    // Basic markdown-like formatting
                    return content
                        .replace(/`([^`]+)`/g, '<code class="bg-gray-200 px-1 rounded">$1</code>')
                        .replace(/\*\*([^*]+)\*\*/g, '<strong>$1</strong>')
                        .replace(/\*([^*]+)\*/g, '<em>$1</em>')
                        .replace(/\n/g, '<br>');
                },
                
                clearChat() {
                    this.chatMessages = [];
                },
                
                // PC Control Functions
                async executePCCommand() {
                    if (!this.pcCommand.command.trim()) return;
                    
                    try {
                        let parameters = null;
                        if (this.pcCommand.parameters.trim()) {
                            parameters = JSON.parse(this.pcCommand.parameters);
                        }
                        
                        const response = await fetch('/pc/command', {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify({
                                command_type: this.pcCommand.type,
                                command: this.pcCommand.command,
                                parameters: parameters
                            })
                        });
                        
                        const data = await response.json();
                        
                        if (data.success) {
                            this.pcOutput = data.output || 'Command executed successfully';
                        } else {
                            this.pcOutput = `Error: ${data.error || 'Command failed'}`;
                        }
                    } catch (error) {
                        this.pcOutput = `Error: ${error.message}`;
                    }
                },
                
                quickCommand(type, command, parameters = null) {
                    this.pcCommand.type = type;
                    this.pcCommand.command = command;
                    this.pcCommand.parameters = parameters ? JSON.stringify(parameters) : '';
                    this.executePCCommand();
                },
                
                // Web Browser Functions
                async executeWebAction() {
                    try {
                        const payload = {
                            action: this.webAction.action
                        };
                        
                        if (this.webAction.url) {
                            if (this.webAction.action === 'search') {
                                payload.text = this.webAction.url;
                            } else {
                                payload.url = this.webAction.url;
                            }
                        }
                        
                        if (this.webAction.selector) {
                            payload.selector = this.webAction.selector;
                        }
                        
                        if (this.webAction.text) {
                            payload.text = this.webAction.text;
                        }
                        
                        const response = await fetch('/web/browse', {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify(payload)
                        });
                        
                        const data = await response.json();
                        
                        if (data.success) {
                            if (data.screenshot) {
                                this.webScreenshot = data.screenshot;
                                this.webOutput = '';
                            } else if (data.data) {
                                this.webOutput = JSON.stringify(data.data, null, 2);
                                this.webScreenshot = '';
                            } else {
                                this.webOutput = 'Action completed successfully';
                                this.webScreenshot = '';
                            }
                        } else {
                            this.webOutput = `Error: ${data.error || 'Action failed'}`;
                            this.webScreenshot = '';
                        }
                    } catch (error) {
                        this.webOutput = `Error: ${error.message}`;
                        this.webScreenshot = '';
                    }
                },
                
                quickWebAction(action, urlOrText = '') {
                    this.webAction.action = action;
                    if (action === 'search') {
                        this.webAction.url = urlOrText;
                        this.webAction.text = '';
                    } else if (action === 'navigate') {
                        this.webAction.url = urlOrText;
                        this.webAction.text = '';
                    } else {
                        this.webAction.url = '';
                        this.webAction.text = urlOrText;
                    }
                    this.executeWebAction();
                },
                
                // System Functions
                async refreshSystemStats() {
                    try {
                        const response = await fetch('/pc/status');
                        const data = await response.json();
                        if (data.system && data.cpu && data.memory) {
                            // Combine system info with performance stats
                            this.systemStats = {
                                ...data.system,
                                cpu_percent: data.cpu.percent,
                                memory_percent: data.memory.percent,
                                disk_percent: data.disk[0] ? data.disk[0].percent : 0,
                                platform: data.system.platform,
                                is_admin: data.system.is_admin
                            };
                        }
                    } catch (error) {
                        console.error('Failed to refresh system stats:', error);
                    }
                },
                
                async refreshProcesses() {
                    try {
                        const response = await fetch('/pc/processes');
                        const data = await response.json();
                        this.processes = data.processes || [];
                    } catch (error) {
                        console.error('Failed to refresh processes:', error);
                    }
                },
                
                // NPU Functions
                async refreshNPUStatus() {
                    try {
                        const response = await fetch('/npu/status');
                        const data = await response.json();
                        this.npuStatus = data;
                        this.npuCapabilities = data.capabilities || {};
                        
                        // Set default selected model for optimization
                        if (!this.selectedOptimizeModel && this.availableModels.length > 0) {
                            this.selectedOptimizeModel = this.availableModels[0];
                        }
                        
                        // Also get performance metrics if NPU is available
                        if (data.npu_available) {
                            await this.refreshNPUPerformance();
                        }
                    } catch (error) {
                        console.error('Failed to refresh NPU status:', error);
                        this.npuStatus = { npu_available: false, device_count: 0, devices: [] };
                    }
                },
                
                async refreshNPUPerformance() {
                    try {
                        const response = await fetch('/npu/performance');
                        const data = await response.json();
                        this.npuPerformance = data;
                    } catch (error) {
                        console.error('Failed to refresh NPU performance:', error);
                        this.npuPerformance = { utilization: 0 };
                    }
                },
                
                async runNPUBenchmark() {
                    try {
                        this.npuOutput = 'Running NPU benchmark...';
                        const response = await fetch('/npu/benchmark', { method: 'POST' });
                        const data = await response.json();
                        this.optimizationResult = data;
                        
                        if (data.success) {
                            this.npuOutput = `Benchmark completed! Execution time: ${data.execution_time.toFixed(3)}s, TOPS: ${data.tops_achieved}`;
                        } else {
                            this.npuOutput = `Benchmark failed: ${data.error}`;
                        }
                    } catch (error) {
                        console.error('NPU benchmark failed:', error);
                        this.npuOutput = `Benchmark error: ${error.message}`;
                    }
                },
                
                async optimizeModelForNPU() {
                    if (!this.selectedOptimizeModel) {
                        alert('Please select a model to optimize');
                        return;
                    }
                    
                    try {
                        const response = await fetch(`/npu/optimize/${this.selectedOptimizeModel}`, { 
                            method: 'POST' 
                        });
                        const data = await response.json();
                        this.optimizationResult = data;
                        
                        if (data.success) {
                            alert(`Model ${this.selectedOptimizeModel} optimized for NPU! Expected speedup: ${data.estimated_speedup}`);
                        } else {
                            alert(`Optimization failed: ${data.error}`);
                        }
                    } catch (error) {
                        console.error('Model optimization failed:', error);
                        alert(`Optimization error: ${error.message}`);
                    }
                },
                
                // GPU Functions
                async refreshGPUStatus() {
                    try {
                        const response = await fetch('/gpu/status');
                        const data = await response.json();
                        this.gpuStatus = data;
                        this.gpuCapabilities = data.capabilities || {};
                        
                        // Get performance metrics if GPU is available
                        if (data.gpus_available) {
                            await this.refreshGPUPerformance();
                        }
                    } catch (error) {
                        console.error('Failed to refresh GPU status:', error);
                        this.gpuStatus = { gpus_available: false, device_count: 0, devices: [], frameworks: {} };
                    }
                },
                
                async refreshGPUPerformance() {
                    try {
                        const response = await fetch('/gpu/performance');
                        const data = await response.json();
                        this.gpuPerformance = data;
                    } catch (error) {
                        console.error('Failed to refresh GPU performance:', error);
                        this.gpuPerformance = { devices: [] };
                    }
                },
                
                async runGPUBenchmark() {
                    try {
                        const response = await fetch('/gpu/benchmark', { method: 'POST' });
                        const data = await response.json();
                        this.optimizationResult = data;
                        
                        if (data.success) {
                            alert(`GPU benchmark completed! Performance score: ${data.performance_score}`);
                        } else {
                            alert(`Benchmark failed: ${data.error}`);
                        }
                    } catch (error) {
                        console.error('GPU benchmark failed:', error);
                        alert(`Benchmark error: ${error.message}`);
                    }
                },
                
                async optimizeModelForAcceleration() {
                    if (!this.selectedOptimizeModel) {
                        alert('Please select a model to optimize');
                        return;
                    }
                    
                    try {
                        let endpoint, params = '';
                        
                        if (this.selectedAccelerationType === 'npu' || 
                           (this.selectedAccelerationType === 'auto' && this.npuStatus.npu_available)) {
                            endpoint = `/npu/optimize/${this.selectedOptimizeModel}`;
                        } else {
                            endpoint = `/gpu/optimize/${this.selectedOptimizeModel}`;
                            if (this.selectedAccelerationType !== 'auto') {
                                params = `?gpu_type=${this.selectedAccelerationType}`;
                            }
                        }
                        
                        const response = await fetch(endpoint + params, { method: 'POST' });
                        const data = await response.json();
                        this.optimizationResult = data;
                        
                        if (data.success) {
                            const accelerationType = data.gpu_type || 'NPU';
                            alert(`Model ${this.selectedOptimizeModel} optimized for ${accelerationType.toUpperCase()}! Expected speedup: ${data.estimated_speedup}`);
                        } else {
                            alert(`Optimization failed: ${data.error}`);
                        }
                    } catch (error) {
                        console.error('Model optimization failed:', error);
                        alert(`Optimization error: ${error.message}`);
                    }
                },
                
                // Real-time Monitoring Functions
                initRealtimeMonitoring() {
                    // Initialize WebSocket connection
                    const wsUrl = `ws://${window.location.host}/ws/monitor`;
                    this.monitoringWebSocket = new WebSocket(wsUrl);
                    
                    this.monitoringWebSocket.onopen = () => {
                        console.log('Real-time monitoring connected');
                        // Request history data
                        this.monitoringWebSocket.send('get_history');
                    };
                    
                    this.monitoringWebSocket.onmessage = (event) => {
                        const message = JSON.parse(event.data);
                        
                        if (message.type === 'update' || message.type === 'initial') {
                            this.realtimeMetrics = message.data;
                            this.updateCharts();
                        } else if (message.type === 'history') {
                            this.initializeCharts(message.data);
                        }
                    };
                    
                    this.monitoringWebSocket.onclose = () => {
                        console.log('Real-time monitoring disconnected');
                        // Attempt reconnection after 5 seconds
                        setTimeout(() => this.initRealtimeMonitoring(), 5000);
                    };
                    
                    this.monitoringWebSocket.onerror = (error) => {
                        console.error('WebSocket error:', error);
                    };
                    
                    // Send periodic pings to keep connection alive
                    setInterval(() => {
                        if (this.monitoringWebSocket && this.monitoringWebSocket.readyState === WebSocket.OPEN) {
                            this.monitoringWebSocket.send('ping');
                        }
                    }, 30000);
                },
                
                initializeCharts(historyData) {
                    // Initialize CPU chart
                    const cpuCanvas = document.getElementById('cpuChart');
                    if (cpuCanvas) {
                        const cpuCtx = cpuCanvas.getContext('2d');
                        this.cpuChart = new Chart(cpuCtx, {
                            type: 'line',
                            data: {
                                labels: historyData.cpu.map((_, i) => i),
                                datasets: [{
                                    label: 'CPU Usage %',
                                    data: historyData.cpu.map(d => d[1]),
                                    borderColor: 'rgb(59, 130, 246)',
                                    backgroundColor: 'rgba(59, 130, 246, 0.1)',
                                    tension: 0.4
                                }]
                            },
                            options: {
                                responsive: true,
                                maintainAspectRatio: false,
                                scales: {
                                    y: {
                                        beginAtZero: true,
                                        max: 100,
                                        ticks: { color: 'rgba(255, 255, 255, 0.7)' },
                                        grid: { color: 'rgba(255, 255, 255, 0.1)' }
                                    },
                                    x: {
                                        ticks: { color: 'rgba(255, 255, 255, 0.7)' },
                                        grid: { color: 'rgba(255, 255, 255, 0.1)' }
                                    }
                                },
                                plugins: {
                                    legend: {
                                        display: false
                                    }
                                }
                            }
                        });
                    }
                    
                    // Initialize GPU chart
                    const gpuCanvas = document.getElementById('gpuChart');
                    if (gpuCanvas) {
                        const gpuCtx = gpuCanvas.getContext('2d');
                        this.gpuChart = new Chart(gpuCtx, {
                            type: 'line',
                            data: {
                                labels: historyData.gpu.map((_, i) => i),
                                datasets: [{
                                    label: 'GPU Usage %',
                                    data: historyData.gpu.map(d => d[1]),
                                    borderColor: 'rgb(251, 146, 60)',
                                    backgroundColor: 'rgba(251, 146, 60, 0.1)',
                                    tension: 0.4
                                }, {
                                    label: 'NPU Usage %',
                                    data: historyData.npu.map(d => d[1]),
                                    borderColor: 'rgb(6, 182, 212)',
                                    backgroundColor: 'rgba(6, 182, 212, 0.1)',
                                    tension: 0.4
                                }]
                            },
                            options: {
                                responsive: true,
                                maintainAspectRatio: false,
                                scales: {
                                    y: {
                                        beginAtZero: true,
                                        max: 100,
                                        ticks: { color: 'rgba(255, 255, 255, 0.7)' },
                                        grid: { color: 'rgba(255, 255, 255, 0.1)' }
                                    },
                                    x: {
                                        ticks: { color: 'rgba(255, 255, 255, 0.7)' },
                                        grid: { color: 'rgba(255, 255, 255, 0.1)' }
                                    }
                                },
                                plugins: {
                                    legend: {
                                        labels: { color: 'rgba(255, 255, 255, 0.8)' }
                                    }
                                }
                            }
                        });
                    }
                },
                
                updateCharts() {
                    // Update CPU chart
                    if (this.cpuChart && this.realtimeMetrics.cpu) {
                        const cpuData = this.cpuChart.data.datasets[0].data;
                        cpuData.push(this.realtimeMetrics.cpu.usage_percent);
                        if (cpuData.length > 60) cpuData.shift();
                        this.cpuChart.update('none');
                    }
                    
                    // Update GPU chart
                    if (this.gpuChart && this.realtimeMetrics.gpu) {
                        const gpuData = this.gpuChart.data.datasets[0].data;
                        const npuData = this.gpuChart.data.datasets[1].data;
                        
                        gpuData.push(this.realtimeMetrics.gpu.average_usage || 0);
                        npuData.push(this.realtimeMetrics.npu?.usage_percent || 0);
                        
                        if (gpuData.length > 60) gpuData.shift();
                        if (npuData.length > 60) npuData.shift();
                        
                        this.gpuChart.update('none');
                    }
                }
            }
        }
    </script>
    
    <!-- Chart.js for real-time charts -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
</body>
</html>
